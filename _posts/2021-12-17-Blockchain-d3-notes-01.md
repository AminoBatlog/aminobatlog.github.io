---
title: 区块链笔记 分叉
key: blockchain20211217001
tags:
  Blockchain
---

区块链笔记3_1:

分叉

笔记记录来源B站[北京大学肖臻老师《区块链技术与应用》公开课]https://www.bilibili.com/video/BV1Vt411X7JF

<!--more-->

---

当两个节点同时挖到了区块同时发布, 就会产生临时性的分叉, 称为 state fork

如果是人为故意造成的分叉, 称为 deliberate fork

如果因为升级软件造成的分叉, 称为protocol fork

根据对协议修改内容的不同, 又可以分为硬分叉和软分叉

**硬分叉(hard fork)**

如果对BTC协议增加新的特性, 还没有升级软件的节点不认可这些新特性, 认为这些新特性是非法的, 那么就导致了节点间对比特币的协议有了分歧

例子: 区块大小限制变大了

![Alt Text](/assets/images/2021-12-17/hard fork.png "硬分叉")

更新过的节点认可新的大区块, 但是没有更新的节点不认可新的大区块, 会各自沿着两条分叉继续延伸, 因为更新软件的区块比较多, 所以大区块所在的链会发展得快一点, 那么后续更新的软件也跟着这个大区块所在的链延伸, 但是没有更新的节点不会认可新链. 这种分叉是永久的, 因为只要还有节点没有更新软件, 那么另一条分叉就会一直延伸

如果一直有人不同意新的协议, 那么会逐渐分裂成两个不同的币种, 各自挖各自的(例如ETC和ETH)

但是如果分开链之后,账户不做任何措施, 那么可能导致在某一条链上的交易, 会在另一条链上被重放(例如转ETH的币结果零一条链的ETC也被转了), 那么措施就是, 加入了ChainID, 记录特定的链

**软分叉(soft fork)**

例子: 区块大小限制变小了

![Alt Text](/assets/images/2021-12-17/soft fork.png "软分叉")

新更新的节点不认可旧节点, 但是旧节点认可新节点, 就导致旧节点的区块不被认可, 所以分叉之后, 新节点挖出来的会成为最长合法链(假设大多数都更新了), 那么旧节点会放弃之前的区块从而到最新合法链上继续挖, 所以这些分叉都是暂时性的

**域**:

之前提到过4bytes的Nonce不够用, 会用coinbase里的8bytes加在一起计算, 但是coinbase不止8B, 剩下的部分, 有人提议用作UTXO的root hash

那么就可以在coinbase里看到UTXO的root hash, 同时UTXO维护一个Merkle Tree, 那么就可以进行账户余额验证了

当进行了一个coinbase要求的更新之后, 算是软分叉

比特币涟上最著名的软分叉就是P2SH更新