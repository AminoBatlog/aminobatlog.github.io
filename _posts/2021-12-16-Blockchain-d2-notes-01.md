---
title: 区块链笔记 网络 挖矿难度 挖矿
key: blockchain20211216001
tags:
  Blockchain
  BTC
---

区块链笔记2_1:

网络 挖矿难度 挖矿

笔记记录来源B站[北京大学肖臻老师《区块链技术与应用》公开课]https://www.bilibili.com/video/BV1Vt411X7JF

<!--more-->

---

> 网络

Application Layer: BitCoin BlockChain

Network Layer: P2P Overlay Network

比特币没有super node或者master node, 都是平等的,但是需要知道seed node,来了解整个网络的情况

比特币的设计原则: Simple, Robust, But not efficient

每个节点维护一个邻居节点的集合,消息在网上传播的时候,采取flooding的方法, 邻居是随机的,不是根据底层拓扑结构安排的

比特币系统中,每个节点需要维护一个等待交易上链的集合, 接受过的交易再接受一次的时候就不会再转发一次了, 如果集合里包含的交易已经上链了,那么就会删掉

交易发布到网络上是best effort的, 不一定所有的节点都能接收到, 不同的节点收到交易的顺序不一定是一样的

---

> 挖矿难度

挖矿本质:

H(block header) <= target

调整target难度,就是调整输出空间占整个空间的比例

使用的Hash Algorithm是SHA-256

difficulty为1的时候,target很大,难度很低

**出块时间太短带来的问题**就是:

时间太短, 区块信息来不及通知所有节点就继续挖了, 容易出现分叉, 挖矿时间越短, 分叉越多, 系统达成共识更难, 对比特币系统不安全. 所以设定好时间, 恶意节点发布51%攻击的难度更高

所以出块时间应该是在一个常数范围内的波动,但是10分钟的BTC对一个交易系统来说太久了,<u>所以ETH使用的是15s一个块, 应用的新的共识协议Ghost, 在这个协议中被抛弃的orphan block也会获得一些奖励,叫做uncle reward</u>

比特币规定每隔2016个区块,就调整难度,大概是14天难度调整一次

target = target * (actual time/expected time)

这里的expected time = 2016*10分钟,就是2星期

actual time = time spent mining the last 2016 blocks, 实际挖矿的时间

意思就是: 如果实际时间超过了2周, 那么整体难度会调整低一点, 如果时间小于两周, 那么难度会高一点. 难度增大最多也只会增大四倍

矿工如何调整? 这个调整代码写入了比特币系统里,自动调节

---

> 挖矿

BTC链上有两种节点,一种是全节点,一种是轻节点

![Alt Text](/assets/images/2021-12-16/full node.png "全节点")

![Alt Text](/assets/images/2021-12-16/light node.png "轻节点")

BTC挖矿设备演变:

CPU -> GPU -> ASIC(Application Specific Integrated Circuit)

有些加密货币设计的是Alternative Mining Puzzle, 设计的出发点是ASIC resistance, 目的是让通用的计算机也能参与挖矿过程

另一种趋势是矿池的出现

矿池的分红机制:

矿主在原先难度的基础上(例如70个0),略微降低难度(例如60个0),当手下的矿工挖到了符合这个降低难度的区块的时候,就称之为一个share(aka. almost valid block), 然后将这个结果提交给矿主. 这个share对挖区块没有任何帮助, 唯一的作用就是作为这个矿工的PoW, 用于后期矿主分红

**可以防止矿工挖到区块自己偷偷提交嘛?** 

可以, 因为任务是矿主分配的, 说不定矿主给每个矿工分配的都是不一样的coinbase parameter, 而且更重要的是,在出块奖励的Tx里, 地址填写的是矿主本人的钱包地址. 如果矿工把钱包地址都改了的话, 那和自己单干没啥区别了

**矿池带来的危害**

如果矿池算力足够多,可以发动51%攻击, 所以只要吸引到足够多的矿工, 就可以左右区块链

**算力足够的矿池能发动的攻击类型**:

分叉攻击(Forking Attack):

算力足够多的时候, 可以做到养一个最长合法链, 从而回滚之前的交易, 因为算力超过了51%, 所以总体链条增长的趋势是要比诚实的节点们快的

![Alt Text](/assets/images/2021-12-16/minepool fork attack.png "高算力进行的分叉攻击")

封锁(Boycott):

可以对某个账户进行封禁, 当被迫害账户A进行交易的时候, 马上进行分叉攻击, 上链一个不包含这个A账户交易信息的区块. 但是如果只是这样, 后续的矿工也可以把交易上链. 但是如果这个51%+算力的矿主官方宣称要抵制被迫害A账户,任何涉及A账户的交易都会被攻击, 那么其他矿工也不敢打包A交易了, 因为哪怕辛辛苦苦算出来, 也会被直接打掉, 努力白费了, 那么就没有人愿意打包A的交易了

![Alt Text](/assets/images/2021-12-16/minepool boycott.png "高算力进行的封禁攻击")

但是没办法强制转账, 因为没有私钥, 强制上链一个有问题的交易, 会导致分叉, 因为诚实的矿工不会顺着不合法的链继续挖, 所以发动攻击的前提是一切的交易都是合法的(但不一定是正确的交易)

**矿池出现的利弊**:

优点: 让个人矿工的收益稳定, 因为只要你参与了矿池, 参与了挖矿, 那么无论谁挖出来的都可以有分红, 比起自己单干要不有要不没有好多了. 概念有点类似于云计算中的on demand computing, 在矿池里是on demand mining, 不需要一直维护一个节点

缺点: 容易集中算力,变得中心化起来

